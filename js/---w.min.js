"use strict";
!function(e) {
    "function" == typeof define && define.amd ? define(["jquery"], e) : "object" == typeof exports ? module.exports = e(require("jquery")) : e(jQuery)
}(function(e) {
    function t(e) {
        return s.raw ? e : encodeURIComponent(e)
    }
    function o(e) {
        return s.raw ? e : decodeURIComponent(e)
    }
    function r(e) {
        return t(s.json ? JSON.stringify(e) : String(e))
    }
    function n(e) {
        0 === e.indexOf('"') && (e = e.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, "\\"));
        try {
            return e = decodeURIComponent(e.replace(a, " ")),
            s.json ? JSON.parse(e) : e
        } catch (e) {}
    }
    function i(t, o) {
        var r = s.raw ? t : n(t);
        return e.isFunction(o) ? o(r) : r
    }
    var a = /\+/g
      , s = e.cookie = function(n, a, c) {
        if (arguments.length > 1 && !e.isFunction(a)) {
            if (c = e.extend({}, s.defaults, c),
            "number" == typeof c.expires) {
                var u = c.expires
                  , l = c.expires = new Date;
                l.setMilliseconds(l.getMilliseconds() + 864e5 * u)
            }
            return document.cookie = [t(n), "=", r(a), c.expires ? "; expires=" + c.expires.toUTCString() : "", c.path ? "; path=" + c.path : "", c.domain ? "; domain=" + c.domain : "", c.secure ? "; secure" : ""].join("")
        }
        for (var d = n ? void 0 : {}, f = document.cookie ? document.cookie.split("; ") : [], p = 0, m = f.length; p < m; p++) {
            var g = f[p].split("=")
              , h = o(g.shift())
              , b = g.join("=");
            if (n === h) {
                d = i(b, a);
                break
            }
            n || void 0 === (b = i(b)) || (d[h] = b)
        }
        return d
    }
    ;
    s.defaults = {},
    e.removeCookie = function(t, o) {
        return e.cookie(t, "", e.extend({}, o, {
            expires: -1
        })),
        !e.cookie(t)
    }
}),
$.ajaxSetup({
    type: "POST",
    data: {
        wTk: $.cookie("wTk")
    }
}),
function(e, t) {
    function o() {}
    function r() {
        return window.ActiveXObject ? new ActiveXObject("Microsoft.XMLHTTP") : window.XMLHttpRequest ? new XMLHttpRequest : void 0
    }
    function n(e, t, o) {
        this.uri_ = "https://" + t + "." + e + "/logstores/" + o + "/track?APIVersion=0.6.0",
        this.params_ = new Array,
        this.httpRequest_ = r()
    }
    function i(e) {
        var t, o, r, n, i, a, s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        for (r = e.length,
        o = 0,
        t = ""; o < r; ) {
            if (n = 255 & e.charCodeAt(o++),
            o == r) {
                t += s.charAt(n >> 2),
                t += s.charAt((3 & n) << 4),
                t += "==";
                break
            }
            if (i = e.charCodeAt(o++),
            o == r) {
                t += s.charAt(n >> 2),
                t += s.charAt((3 & n) << 4 | (240 & i) >> 4),
                t += s.charAt((15 & i) << 2),
                t += "=";
                break
            }
            a = e.charCodeAt(o++),
            t += s.charAt(n >> 2),
            t += s.charAt((3 & n) << 4 | (240 & i) >> 4),
            t += s.charAt((15 & i) << 2 | (192 & a) >> 6),
            t += s.charAt(63 & a)
        }
        return t
    }
    function a(e) {
        var t, o, r, n, i, a, s, c = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1];
        for (a = e.length,
        i = 0,
        s = ""; i < a; ) {
            do {
                t = c[255 & e.charCodeAt(i++)]
            } while (i < a && -1 == t);if (-1 == t)
                break;
            do {
                o = c[255 & e.charCodeAt(i++)]
            } while (i < a && -1 == o);if (-1 == o)
                break;
            s += String.fromCharCode(t << 2 | (48 & o) >> 4);
            do {
                if (61 == (r = 255 & e.charCodeAt(i++)))
                    return s;
                r = c[r]
            } while (i < a && -1 == r);if (-1 == r)
                break;
            s += String.fromCharCode((15 & o) << 4 | (60 & r) >> 2);
            do {
                if (61 == (n = 255 & e.charCodeAt(i++)))
                    return s;
                n = c[n]
            } while (i < a && -1 == n);if (-1 == n)
                break;
            s += String.fromCharCode((3 & r) << 6 | n)
        }
        return s
    }
    var s = new o;
    (+new Date).toString(),
    Math.floor(99999 * Math.random());
    s.extend = o.prototype.extend = t.extend,
    s.extend(s, {
        list: function() {
            var e, t = this, o = [];
            for (e in t)
                o.push(e);
            return o
        },
        isLogin: function() {
            return document.cookie.indexOf("m_c") >= 0 ? 1 : 0
        }(),
        updateIsLogin: function() {
            this.isLogin = function() {
                return document.cookie.indexOf("m_c") >= 0 ? 1 : 0
            }()
        },
        isMobile: function() {
            return /iPhone|iPod|mobile|ios|android|UCBrowser|MQQBrowser|BlackBerry|IEMobile/gi.test(navigator.userAgent.toLowerCase())
        }(),
        WbCustomerService: function(e) {
            var o, r = t.cookie("m_c") ? 1 : 0, n = t.cookie("m_c"), i = t.cookie("b_n"), a = {
                wbSellerid: "",
                customerServiceCode: "wx_1000_1515726307656"
            }, s = wb.extend(a, e);
            window.NTKF_PARAM || (window.NTKF_PARAM = wb.extend({
                siteid: "wx_1000",
                sellerid: s.wbSellerid,
                settingid: s.customerServiceCode,
                uid: n || "",
                uname: i || "",
                isvip: r,
                userlevel: "0"
            }, {
                itemid: wb.itemid || "",
                itemparam: wb.itemparam || "",
                orderid: wb.orderid || "",
                orderprice: wb.orderprice || ""
            })),
            this.open = function() {
                wb.corsAjax({
                    subWbDomain: wb.isMobile ? "h5api" : "gapi",
                    url: "/pub/keywordAsk/",
                    data: {
                        keywordFlag: 1,
                        sessionId: t.cookie("wbiaoid"),
                        sourceCode: 0
                    },
                    complete: function() {
                        window.NTKF && NTKF.im_openInPageChat(s.customerServiceCode)
                    },
                    success: function(e) {
                        e.isCps && (t("#kf-wbiaoId").length || t("body").append('<input type="hidden" value="' + t.cookie("wbiaoid") + '" id="kf-wbiaoId">'))
                    }
                });
                try {
                    (new wb.Logger).log2.send({
                        event: "contactCustomService",
                        eventPageType: wb.isMobile ? "h5" : "html"
                    })
                } catch (e) {
                    console.log("logger-error", e.message)
                }
            }
            ,
            t("#__isLoadCustomerJs__").length || (o = document.createElement("script"),
            o.type = "text/javascript",
            o.id = "__isLoadCustomerJs__",
            o.src = "//dl.wbiao.com/js/b2b/ntkfstat.js?siteid=wx_1000",
            o.charset = "utf-8",
            document.body.appendChild(o))
        },
        globalCart: {
            add: function(e) {
                function o() {
                    var e = t.parseJSON(localStorage.getItem("cart"))
                      , o = e || {};
                    if (o[i.goodsCode] ? o[i.goodsCode].quantity ? o[i.goodsCode].quantity += i.quantity : o[i.goodsCode].quantity = i.quantity : (o[i.goodsCode] = {},
                    o[i.goodsCode].quantity = i.quantity),
                    i.salePrice && (o[i.goodsCode].salePrice = i.salePrice),
                    i.extendValue)
                        for (r in i.extendValue)
                            o[r] = i.extendValue[r];
                    localStorage.setItem("cart", JSON.stringify(o)),
                    i.success && i.success({
                        info: {
                            error: 0,
                            message: "ok"
                        }
                    })
                }
                var r, n = {
                    goodsCode: null,
                    quantity: 1,
                    salePrice: null,
                    extendValue: null,
                    success: null
                }, i = t.extend(n, e);
                if (!i.goodsCode || Number(i.salePrice) <= 0)
                    return !1;
                0 === wb.isLogin ? o() : 1 === wb.isLogin && function() {
                    t.ajax({
                        type: "post",
                        url: "/pub/cart/add",
                        dataType: "json",
                        data: {
                            cartModel: {
                                goodsCode: i.goodsCode,
                                quantity: i.quantity
                            }
                        },
                        success: function(e) {
                            403 === e.info.error ? o() : i.success && i.success(e)
                        }
                    })
                }()
            },
            getQuantity: function(e) {
                var o = {
                    success: function() {}
                }
                  , r = t.extend(o, e);
                0 === wb.isLogin ? function() {
                    var e, o = 0, n = t.parseJSON(localStorage.getItem("cart"));
                    if (n) {
                        for (e in n)
                            n[e].quantity && (o += n[e].quantity);
                        r.success && r.success(o)
                    } else
                        r.success && r.success(0)
                }() : 1 === wb.isLogin && function() {
                    t.ajax({
                        type: "POST",
                        url: "/pub/cart/getQuantity",
                        dataType: "json",
                        data: {},
                        success: function(e) {
                            0 === e.info.error ? r.success && r.success(e.data) : r.success && r.success(0)
                        }
                    })
                }()
            },
            remove: function(e, o, r) {
                if (!e)
                    return !1;
                var n = {
                    success: null
                }
                  , i = t.extend(n, r);
                if (!o)
                    return !1;
                0 === wb.isLogin ? function() {
                    var o = t.parseJSON(localStorage.getItem("cart"));
                    o[String(e)] && (o[String(e)] = null,
                    delete o[String(e)]),
                    localStorage.setItem("cart", JSON.stringify(o)),
                    i.success && i.success({
                        info: {
                            error: 0,
                            message: "ok"
                        },
                        data: {
                            currentData: o
                        }
                    })
                }() : 1 === wb.isLogin && function() {
                    t.ajax({
                        type: "post",
                        url: "/pub/cart/delete",
                        dataType: "json",
                        data: {
                            cartId: o || 0
                        },
                        success: function(e) {
                            i.success && i.success(e)
                        }
                    })
                }()
            },
            batchRemove: function(e, o) {
                if (0 === wb.isLogin)
                    return !1;
                var r = {
                    success: null
                }
                  , n = t.extend(r, o);
                t.ajax({
                    type: "POST",
                    url: "/pub/cart/batchDelete",
                    dataType: "json",
                    data: {
                        cartIdList: e
                    },
                    success: function(e) {
                        n.success && n.success(e)
                    }
                })
            }
        },
        globalCollect: {
            add: function(e, o, r) {
                if (0 === wb.isLogin || !e || !o)
                    return !1;
                t.ajax({
                    type: "post",
                    dataType: "json",
                    url: "/goods/collect/addCollect",
                    data: {
                        code: e,
                        type: o
                    },
                    success: function(e) {
                        r && r(e)
                    }
                })
            }
        },
        setTrackData: function(e) {
            if (!e || !t.isPlainObject(e))
                return !1;
            this.trackData ? t.extend(this.trackData, e) : this.trackData = t.extend({}, e)
        },
        trackData: null,
        track: function(e) {},
        Logger: function() {
            function e(e, o) {
                var r = t.extend({}, u, o, {
                    eventTime: Math.round(+new Date / 1e3)
                })
                  , i = new n(a.host,a.project,e);
                for (var s in r)
                    i.push(s, r[s]);
                i.logger()
            }
            var o = wb.tools.psl()
              , r = /WBIAO_MARKET_([\d\.]+)_IOS_([\d_]+)/
              , i = /WBIAO_MARKET_([\d\._]+)\scom.wbiao.wbapp\s([\d\s\.]+)/
              , a = {
                project: (o.domain && o.domain.toLowerCase(),
                "wbiao-probe"),
                host: "cn-hangzhou.log.aliyuncs.com",
                logstore: "probe_log0"
            }
              , s = i.test(navigator.userAgent)
              , c = r.test(navigator.userAgent)
              , u = {
                cid: t.cookie("wbiaoid"),
                memberCode: Number(t.cookie("m_c")) || 0,
                station: "mall",
                version: "",
                cip: "",
                latitud: "",
                longitud: "",
                event: "",
                eventApp: s ? "android" : c ? "iphone" : wb.isMobile ? "m" : "pc",
                eventTime: "",
                eventPage: "",
                eventPageType: "",
                eventProps: void 0,
                userAgent: navigator.userAgent || ""
            };
            this.log0 = {
                send: function(t) {
                    e("probe_log0", t)
                }
            },
            this.log1 = {
                send: function(t) {
                    e("probe_log1", t)
                }
            },
            this.log2 = {
                send: function(t) {
                    e("probe_log2", t)
                }
            }
        },
        info: function() {
            try {
                return JSON.parse(this.tools.base64decode(t.cookie("w_info")))
            } catch (e) {
                return {}
            }
        },
        isIE: function(e) {
            var t, o = navigator.userAgent.toLowerCase(), r = !1, n = document.createElement("b");
            if (n.innerHTML = "\x3c!--[if IE " + e + "]><i></i><![endif]--\x3e",
            e >= 10)
                try {
                    t = null !== o.match(/msie ([\d.]+)/) ? o.match(/msie ([\d.]+)/)[1] : o.match(/rv:([\d.]+)/)[1],
                    r = parseInt(Number(t)) === e
                } catch (e) {
                    r = !1
                }
            else
                r = 1 === n.getElementsByTagName("i").length;
            return r
        },
        tools: {
            getUrlParam: function(e) {
                for (var t, o, r, n = window.location.search.substr(1), i = n.split("&"), a = {}, s = 0; s < i.length; s++)
                    (t = i[s].indexOf("=")) > 0 && (r = i[s].substring(0, t),
                    o = i[s].substr(t + 1),
                    this[r] = o,
                    a[r] = decodeURIComponent(o));
                return e ? a[e] : a
            },
            setUrlParam: function(e, t, o) {
                var r, n = "", i = e.split("?"), a = i[0], s = i[1], c = "";
                if (s)
                    for (i = s.split("&"),
                    r = 0; r < i.length; r++)
                        i[r].split("=")[0] !== t && (n += c + i[r],
                        c = "&");
                var u = c + "" + t;
                return o && (u += "=" + o),
                a + "?" + n + u
            },
            delUrlParam: function(e, t) {
                var o = e.substr(e.indexOf("?") + 1)
                  , r = e.substr(0, e.indexOf("?"))
                  , n = ""
                  , i = new Array;
                if ("" != o)
                    for (var a = o.split("&"), s = 0; s < a.length; s++) {
                        var c = a[s].split("=");
                        c[0] != t && i.push(a[s])
                    }
                return i.length > 0 && (n = "?" + i.join("&")),
                e = r + n
            },
            base64encode: i,
            base64decode: a,
            addCodeToDom: function(e) {
                var o, r, n = {
                    selElement: "head",
                    labelName: null,
                    insertOrNot: !0,
                    externalFile: !1,
                    insertCode: null,
                    customAttr: {}
                }, i = t.extend(n, e), a = t("<" + i.labelName + "></" + i.labelName + ">");
                if (!i.labelName || "script" != i.labelName.toLowerCase() && "img" != i.labelName.toLowerCase() ? i.labelName && "link" == i.labelName.toLowerCase() && (r = "href",
                i.customAttr = Object.assign(i.customAttr, {
                    rel: "stylesheet",
                    charset: "utf-8"
                })) : r = "src",
                o = i.externalFile ? a.attr(r, i.insertCode) : a.text(i.insertCode),
                i.customAttr)
                    for (var s in i.customAttr)
                        o = o.attr(s, i.customAttr[s]);
                return i.onLoadSuccess && (o = o.attr("onload", i.onLoadSuccess)),
                i.insertOrNot && t(i.selElement).append(o),
                t(o)[0]
            },
            psl: function() {
                var e = document.domain.split(".")
                  , t = {};
                try {
                    t.domain = e.slice(-2).join(".") || null,
                    e.slice(0, -2).length > 0 && (t.subDomain = e.slice(0, -2).join(".") || null)
                } catch (e) {
                    t = null,
                    console.log("psl error: ", e.message)
                }
                return t
            }
        },
        checkLogin: function() {
            if (!e.localStorage)
                return !1;
            t.cookie("m_c") && e.localStorage.getItem("m_c") && t.cookie("m_c") !== e.localStorage.getItem("m_c") && t.ajax({
                type: "GET",
                url: "/pub/clean/loginInfo",
                dataType: "json",
                data: {
                    mcInLocal: e.localStorage.getItem("m_c"),
                    curUrl: location.href
                },
                cache: !1,
                success: function(o) {
                    0 === o.info.error && (s.isLogin = 0,
                    t.removeCookie("m_c"),
                    t.removeCookie("b_n"),
                    e.localStorage.removeItem("m_c"),
                    s.isMobile || (wb.wbCustomerService && (wb.wbCustomerService = new wb.WbCustomerService),
                    t(".W_pt_top .pt_top_login").html('<a href="http://www.wb.node/member/login/" class="login_a">登录享优惠</a><a href="http://www.wb.node/member/register/" target="_blank" class="pt_register">注册</a>')))
                }
            })
        },
        loginToLocal: function() {
            if (!e.localStorage)
                return !1;
            t.cookie("m_c") && localStorage.setItem("m_c", t.cookie("m_c"))
        },
        trackRecm: function(e) {},
        corsAjax: function(e) {
            var o = {
                subWbDomain: "pu",
                cache: !1,
                dataType: "jsonp",
                jsonp: "callback"
            }
              , r = this.tools.psl();
            t.extend(o, e);
            var n = [o.subWbDomain, r.domain].join(".")
              , i = /^(\/\/)|^(http:\/\/)|^(https:\/\/)/.test(e.url) ? e.url : ["//", n, "/", e.url.replace(/^\//, "")].join("")
              , a = t.extend({}, o, e, {
                url: i
            });
            t.ajax(a)
        },
        domains: function() {
            var e = this.tools.psl().domain
              , t = {
                www: "www." + e,
                m: "m." + e,
                pu: "pu." + e,
                mu: "mu." + e
            };
            return "wbiaotest.cn" === e && (t.www = "w-test." + e,
            t.m = "m-test." + e),
            t
        },
        urlRandomized: function(e, t) {
            var o = Math.random().toString(36).substr(2) + Math.random().toString(36).substr(2);
            return this.tools.setUrlParam(e, t || "nonStr", o)
        },
        fillUpUserModuleUrl: function(e, o) {
            if (/^((\/\/)|http|https)/.test(e))
                return !1;
            var r = ""
              , n = this.tools.psl()
              , i = ""
              , a = {
                domain: n.domain,
                protocol: location.protocol,
                nonStr: !0,
                referrerDomain: null,
                referrerPath: null,
                referrer: null
            }
              , s = t.extend({}, a, o);
            return r += (s.protocol ? s.protocol.replace(/:$/, "") + ":" : "") + "//" + s.domain + "/" + e.replace(/^\//, ""),
            !s.referrer && s.referrerDomain && s.referrerPath ? (i += location.protocol + "//" + s.referrerDomain + "/" + s.referrerPath.replace(/^\//, ""),
            r = this.tools.setUrlParam(r, "referrer", encodeURIComponent(i))) : s.referrer && (r = this.tools.setUrlParam(r, "referrer", encodeURIComponent(s.referrer))),
            s.nonStr ? this.urlRandomized(r) : r
        },
        cleanWbiaoid: function() {
            try {
                if (document.cookie.match(/wbiaoid(?!\.sig)/g).length > 1) {
                    for (var e = 0; e < 2; e++)
                        t.cookie("wbiaoid", "", {
                            expires: -1
                        }),
                        t.cookie("wbiaoid.sig", "", {
                            expires: -1
                        });
                    t.ajax({
                        type: "GET",
                        url: "/pub/cleanwbiaoid",
                        dataType: "json"
                    })
                }
            } catch (e) {}
        },
        CountDown: function(e) {
            function t(e) {
                return e < 10 ? "0" + e : e
            }
            var o, r;
            this.start = function() {
                var n = setInterval(function() {
                    o = +new Date,
                    r = (e.end - o) / 1e3;
                    var i = Math.floor(r / 60 / 60 / 24);
                    r < 0 && (r = 0,
                    clearInterval(n)),
                    e.step && e.step({
                        d: 0 === i ? 0 : i,
                        h: t(Math.floor(r / 60 / 60 % 24)),
                        m: t(Math.floor(r / 60 % 60)),
                        s: t(Math.floor(r % 60))
                    })
                }, 1e3)
            }
        }
    }),
    n.prototype = {
        push: function(e, o) {
            if (e && (0 === o || o))
                if (t.isPlainObject(o))
                    try {
                        this.params_.push(e),
                        this.params_.push(JSON.stringify(o))
                    } catch (e) {}
                else
                    this.params_.push(e),
                    this.params_.push(o)
        },
        logger: function() {
            for (var e = this.uri_, t = 0; this.params_.length > 0; )
                e += t % 2 == 0 ? "&" + encodeURIComponent(this.params_.shift()) : "=" + encodeURIComponent(this.params_.shift()),
                ++t;
            try {
                this.httpRequest_.open("GET", e, !0),
                this.httpRequest_.send(null)
            } catch (t) {
                window && window.console && "function" == typeof window.console.log && (console.log("Failed to log to ali log service because of this exception:\n" + t),
                console.log("Failed log data:", e))
            }
        }
    },
    e.wbiao = e.wb = s
}(window, jQuery);
